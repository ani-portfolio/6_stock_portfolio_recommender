# prefect.yaml
name: stock-portfolio-recommender
prefect-version: 3.4.6

# Build section - no build needed for Python flows
build: null

# Push section - no push needed since code is on GitHub
push: null

# Pull section - clone from GitHub when running
pull:
  - prefect.deployments.steps.git_clone:
      repository: https://github.com/ani-portfolio/6_stock_portfolio_recommender.git
      branch: feature/prefect

# Define deployments
deployments:
  - name: update-stock-data-bigquery
    version: 1.0.0
    tags:
      - stock-data
      - bigquery
    description: Updates stock data in BigQuery every 6 hours
    schedule:
      cron: "0 */6 * * *"
      timezone: "EST"
    entrypoint: scripts/update_stock_data.py:main
    work_pool:
      name: default-work-pool
      job_variables:
        env:
          # These will be resolved from Prefect Secrets at runtime
          GOOGLE_APPLICATION_CREDENTIALS_JSON: "{{ prefect.blocks.secret.recommendation-app-gcp-sa-key-dev }}"
    parameters: {}